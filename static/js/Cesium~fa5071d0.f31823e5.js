(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Cesium~fa5071d0"],{"0a40":function(e,t,a){"use strict";var r=a("2f63"),i=a("7d62"),n=a("fe57"),o=a("e90c"),s=a("0249"),c=a("a307");function u(e,t,a,r,i){this.numberOfDayTextures=e,this.flags=t,this.material=a,this.shaderProgram=r,this.clippingShaderState=i}function d(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}function l(e){const t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }",a="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }",r="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }";let i;switch(e){case c["a"].SCENE3D:i=t;break;case c["a"].SCENE2D:case c["a"].COLUMBUS_VIEW:i=a;break;case c["a"].MORPHING:i=r;break}return i}function h(e){const t="float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }",a="float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }";return e?a:t}d.prototype.getShaderProgram=function(e){const t=e.frameState,a=e.surfaceTile,i=e.numberOfDayTextures,c=e.applyBrightness,d=e.applyContrast,p=e.applyHue,m=e.applySaturation,f=e.applyGamma,g=e.applyAlpha,_=e.applyDayNightAlpha,y=e.applySplit,b=e.showReflectiveOcean,T=e.showOceanWaves,C=e.enableLighting,S=e.dynamicAtmosphereLighting,A=e.dynamicAtmosphereLightingFromSun,v=e.showGroundAtmosphere,x=e.perFragmentGroundAtmosphere,E=e.hasVertexNormals,O=e.useWebMercatorProjection,D=e.enableFog,F=e.enableClippingPlanes,w=e.clippingPlanes,R=e.clippedByBoundaries,L=e.hasImageryLayerCutout,N=e.colorCorrect,M=e.highlightFillTile,P=e.colorToAlpha,I=e.hasGeodeticSurfaceNormals,B=e.hasExaggeration,j=e.showUndergroundColor,H=e.translucent;let k=0,U="";const G=a.renderedMesh,V=G.encoding,z=V.quantization;z===n["a"].BITS12&&(k=1,U="QUANTIZATION_BITS12");let W=0,Y="";R&&(W=1,Y="TILE_LIMIT_RECTANGLE");let q=0,K="";L&&(q=1,K="APPLY_IMAGERY_CUTOUT");const $=t.mode,Q=$|c<<2|d<<3|p<<4|m<<5|f<<6|g<<7|b<<8|T<<9|C<<10|S<<11|A<<12|v<<13|x<<14|E<<15|O<<16|D<<17|k<<18|y<<19|F<<20|W<<21|q<<22|N<<23|M<<24|P<<25|I<<26|B<<27|j<<28|H<<29|_<<30;let X=0;Object(r["a"])(w)&&w.length>0&&(X=F?w.clippingPlanesState:0);let Z=a.surfaceShader;if(Object(r["a"])(Z)&&Z.numberOfDayTextures===i&&Z.flags===Q&&Z.material===this.material&&Z.clippingShaderState===X)return Z.shaderProgram;let J=this._shadersByTexturesFlags[i];if(Object(r["a"])(J)||(J=this._shadersByTexturesFlags[i]=[]),Z=J[Q],!Object(r["a"])(Z)||Z.material!==this.material||Z.clippingShaderState!==X){const e=this.baseVertexShaderSource.clone(),a=this.baseFragmentShaderSource.clone();0!==X&&a.sources.unshift(Object(s["a"])(w,t.context)),e.defines.push(U),a.defines.push("TEXTURE_UNITS "+i,Y,K),c&&a.defines.push("APPLY_BRIGHTNESS"),d&&a.defines.push("APPLY_CONTRAST"),p&&a.defines.push("APPLY_HUE"),m&&a.defines.push("APPLY_SATURATION"),f&&a.defines.push("APPLY_GAMMA"),g&&a.defines.push("APPLY_ALPHA"),_&&a.defines.push("APPLY_DAY_NIGHT_ALPHA"),b&&(a.defines.push("SHOW_REFLECTIVE_OCEAN"),e.defines.push("SHOW_REFLECTIVE_OCEAN")),T&&a.defines.push("SHOW_OCEAN_WAVES"),P&&a.defines.push("APPLY_COLOR_TO_ALPHA"),j&&(e.defines.push("UNDERGROUND_COLOR"),a.defines.push("UNDERGROUND_COLOR")),H&&(e.defines.push("TRANSLUCENT"),a.defines.push("TRANSLUCENT")),C&&(E?(e.defines.push("ENABLE_VERTEX_LIGHTING"),a.defines.push("ENABLE_VERTEX_LIGHTING")):(e.defines.push("ENABLE_DAYNIGHT_SHADING"),a.defines.push("ENABLE_DAYNIGHT_SHADING"))),S&&(e.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),a.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),A&&(e.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN"),a.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN"))),v&&(e.defines.push("GROUND_ATMOSPHERE"),a.defines.push("GROUND_ATMOSPHERE"),x&&(e.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE"),a.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE"))),e.defines.push("INCLUDE_WEB_MERCATOR_Y"),a.defines.push("INCLUDE_WEB_MERCATOR_Y"),D&&(e.defines.push("FOG"),a.defines.push("FOG")),y&&a.defines.push("APPLY_SPLIT"),F&&a.defines.push("ENABLE_CLIPPING_PLANES"),N&&a.defines.push("COLOR_CORRECT"),M&&a.defines.push("HIGHLIGHT_FILL_TILE"),I&&e.defines.push("GEODETIC_SURFACE_NORMALS"),B&&e.defines.push("EXAGGERATION");let r="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend)\n    {\n        vec4 color = initialColor;\n";L&&(r+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(let t=0;t<i;++t)r+=L?`        cutoutAndColorResult = u_dayTextureCutoutRectangles[${t}];\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\n        cutoutAndColorResult = sampleAndBlend(\n`:"        color = sampleAndBlend(\n",r+=`            color,\n            u_dayTextures[${t}],\n            u_dayTextureUseWebMercatorT[${t}] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle[${t}],\n            u_dayTextureTranslationAndScale[${t}],\n            ${g?`u_dayTextureAlpha[${t}]`:"1.0"},\n            ${_?`u_dayTextureNightAlpha[${t}]`:"1.0"},\n${_?`u_dayTextureDayAlpha[${t}]`:"1.0"},\n${c?`u_dayTextureBrightness[${t}]`:"0.0"},\n            ${d?`u_dayTextureContrast[${t}]`:"0.0"},\n            ${p?`u_dayTextureHue[${t}]`:"0.0"},\n            ${m?`u_dayTextureSaturation[${t}]`:"0.0"},\n            ${f?`u_dayTextureOneOverGamma[${t}]`:"0.0"},\n            ${y?`u_dayTextureSplit[${t}]`:"0.0"},\n            ${P?`u_colorsToAlpha[${t}]`:"vec4(0.0)"},\n        nightBlend        );\n`,L&&(r+="        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");r+="        return color;\n    }",a.sources.push(r),e.sources.push(l($)),e.sources.push(h(O));const n=o["a"].fromCache({context:t.context,vertexShaderSource:e,fragmentShaderSource:a,attributeLocations:V.getAttributeLocations()});Z=J[Q]=new u(i,Q,this.material,n,X)}return a.surfaceShader=Z,Z.shaderProgram},d.prototype.destroy=function(){let e,t;const a=this._shadersByTexturesFlags;for(const i in a)if(a.hasOwnProperty(i)){const n=a[i];if(!Object(r["a"])(n))continue;for(e in n)n.hasOwnProperty(e)&&(t=n[e],Object(r["a"])(t)&&t.shaderProgram.destroy())}return Object(i["a"])(this)},t["a"]=d},"1deb":function(e,t,a){"use strict";var r=a("cef5"),i=a("7229"),n=a("be18"),o=a("bef8"),s=a("bd8d"),c=a("535a"),u=a("2f63"),d=a("7d62"),l=a("c52f"),h=a("204a"),p=a("21d7"),m=a("5410"),f=a("6dfc"),g=a("2ac3"),_=a("eace"),y=a("d4ed"),b=a("5770"),T=a("a913"),C=a("7b51"),S=a("a252"),A=a("b0df"),v=a("fe19"),x=a("0a40"),E=a("3209"),O=a("5225"),D=a("506f"),F=a("c17f"),w=a("a307"),R=a("c86b");function L(e){e=Object(c["a"])(e,l["a"].WGS84);const t=new h["a"]({ellipsoid:e}),a=new D["a"];this._ellipsoid=e,this._imageryLayerCollection=a,this._surfaceShaderSet=new x["a"],this._material=void 0,this._surface=new F["a"]({tileProvider:new E["a"]({terrainProvider:t,imageryLayers:a,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new p["a"],this._undergroundColor=s["a"].clone(s["a"].BLACK),this._undergroundColorAlphaByDistance=new f["a"](e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new O["a"],N(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new y["a"]({url:Object(i["a"])("Assets/Textures/waterNormalsSmall.jpg")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.lambertDiffuseMultiplier=.9,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.atmosphereLightIntensity=10,this.atmosphereRayleighCoefficient=new n["a"](55e-7,13e-6,284e-7),this.atmosphereMieCoefficient=new n["a"](21e-6,21e-6,21e-6),this.atmosphereRayleighScaleHeight=1e4,this.atmosphereMieScaleHeight=3200,this.atmosphereMieAnisotropy=.9,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=R["a"].RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.terrainExaggeration=1,this.terrainExaggerationRelativeHeight=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function N(e){const t=[],a=Object(u["a"])(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),r=[A["a"],v["a"]];!Object(u["a"])(e._material)||a&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.materialUniformMap=void 0:(r.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms),r.push(C["a"]),e._surfaceShaderSet.baseVertexShaderSource=new b["a"]({sources:[A["a"],v["a"],S["a"]],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new b["a"]({sources:r,defines:t}),e._surfaceShaderSet.material=e._material}function M(e){return function(t,a){const i=r["a"].distanceSquaredTo(t.pickBoundingSphere,e),n=r["a"].distanceSquaredTo(a.pickBoundingSphere,e);return i-n}}Object.defineProperties(L.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!Object(u["a"])(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){Object(u["a"])(e)||(e=_["a"].clone(_["a"].MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),Object(u["a"])(this._material)&&N(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,N(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=s["a"].clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=f["a"].clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});const P=[],I={start:0,stop:0};L.prototype.pickWorldCoordinates=function(e,t,a,i){a=Object(c["a"])(a,!0);const o=t.mode,s=t.mapProjection,d=P;d.length=0;const l=this._surface._tilesToRender;let h,p,f,g=l.length;for(p=0;p<g;++p){h=l[p];const t=h.data;if(!Object(u["a"])(t))continue;let a=t.pickBoundingSphere;if(o!==w["a"].SCENE3D)t.pickBoundingSphere=a=r["a"].fromRectangleWithHeights2D(h.rectangle,s,t.tileBoundingRegion.minimumHeight,t.tileBoundingRegion.maximumHeight,a),n["a"].fromElements(a.center.z,a.center.x,a.center.y,a.center);else{if(!Object(u["a"])(t.renderedMesh))continue;r["a"].clone(t.tileBoundingRegion.boundingSphere,a)}const i=m["a"].raySphere(e,a,I);Object(u["a"])(i)&&d.push(t)}for(d.sort(M(e.origin)),g=d.length,p=0;p<g;++p)if(f=d[p].pick(e,t.mode,t.mapProjection,a,i),Object(u["a"])(f))break;return f};const B=new o["a"];L.prototype.pick=function(e,t,a){if(a=this.pickWorldCoordinates(e,t,!0,a),Object(u["a"])(a)&&t.mode!==w["a"].SCENE3D){a=n["a"].fromElements(a.y,a.z,a.x,a);const e=t.mapProjection.unproject(a,B);a=t.globe.ellipsoid.cartographicToCartesian(e,a)}return a};const j=new n["a"],H=new n["a"],k=new o["a"],U=new g["a"];function G(e,t){return Object(u["a"])(e)&&_["a"].contains(e.rectangle,t)?e:void 0}L.prototype.getHeight=function(e){const t=this._surface._levelZeroTiles;if(!Object(u["a"])(t))return;let a,r;const i=t.length;for(r=0;r<i;++r)if(a=t[r],_["a"].contains(a.rectangle,e))break;if(r>=i)return;let o=a;while(Object(u["a"])(a))a=G(a._southwestChild,e)||G(a._southeastChild,e)||G(a._northwestChild,e)||a._northeastChild,Object(u["a"])(a)&&Object(u["a"])(a.data)&&Object(u["a"])(a.data.renderedMesh)&&(o=a);if(a=o,!Object(u["a"])(a)||!Object(u["a"])(a.data)||!Object(u["a"])(a.data.renderedMesh))return;const s=this._surface._tileProvider.tilingScheme.projection,d=this._surface._tileProvider.tilingScheme.ellipsoid,l=n["a"].fromRadians(e.longitude,e.latitude,0,d,j),h=U,p=d.geodeticSurfaceNormal(l,h.direction),m=d.getSurfaceNormalIntersectionWithZAxis(l,11500,h.origin);if(!Object(u["a"])(m)){let e;Object(u["a"])(a.data.tileBoundingRegion)&&(e=a.data.tileBoundingRegion.minimumHeight);const t=Math.min(Object(c["a"])(e,0),-11500),r=n["a"].multiplyByScalar(p,Math.abs(t)+1,H);n["a"].subtract(l,r,h.origin)}const f=a.data.pick(h,void 0,s,!1,H);return Object(u["a"])(f)?d.cartesianToCartographic(f,k).height:void 0},L.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},L.prototype.beginFrame=function(e){const t=this._surface,a=t.tileProvider,r=this.terrainProvider,i=this.showWaterEffect&&r.ready&&r.hasWaterMask;if(i&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;const t=this._oceanNormalMapResource,a=t.url;if(Object(u["a"])(a)){const r=this;t.fetchImage().then((function(t){a===r._oceanNormalMapResource.url&&(r._oceanNormalMap=r._oceanNormalMap&&r._oceanNormalMap.destroy(),r._oceanNormalMap=new T["a"]({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}const n=e.passes,o=e.mode;n.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,a.terrainProvider=this.terrainProvider,a.lightingFadeOutDistance=this.lightingFadeOutDistance,a.lightingFadeInDistance=this.lightingFadeInDistance,a.nightFadeOutDistance=this.nightFadeOutDistance,a.nightFadeInDistance=this.nightFadeInDistance,a.zoomedOutOceanSpecularIntensity=o===w["a"].SCENE3D?this._zoomedOutOceanSpecularIntensity:0,a.hasWaterMask=i,a.oceanNormalMap=this._oceanNormalMap,a.enableLighting=this.enableLighting,a.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,a.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,a.showGroundAtmosphere=this.showGroundAtmosphere,a.atmosphereLightIntensity=this.atmosphereLightIntensity,a.atmosphereRayleighCoefficient=this.atmosphereRayleighCoefficient,a.atmosphereMieCoefficient=this.atmosphereMieCoefficient,a.atmosphereRayleighScaleHeight=this.atmosphereRayleighScaleHeight,a.atmosphereMieScaleHeight=this.atmosphereMieScaleHeight,a.atmosphereMieAnisotropy=this.atmosphereMieAnisotropy,a.shadows=this.shadows,a.hueShift=this.atmosphereHueShift,a.saturationShift=this.atmosphereSaturationShift,a.brightnessShift=this.atmosphereBrightnessShift,a.fillHighlightColor=this.fillHighlightColor,a.showSkirts=this.showSkirts,a.backFaceCulling=this.backFaceCulling,a.undergroundColor=this._undergroundColor,a.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,a.lambertDiffuseMultiplier=this.lambertDiffuseMultiplier,t.beginFrame(e))},L.prototype.render=function(e){this.show&&(Object(u["a"])(this._material)&&this._material.update(e.context),this._surface.render(e))},L.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},L.prototype.isDestroyed=function(){return!1},L.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),Object(d["a"])(this)},t["a"]=L},2856:function(e,t,a){"use strict";var r=a("cef5"),i=a("be18"),n=a("a561"),o=a("bef8"),s=a("2f63"),c=a("0123"),u=a("5410"),d=a("e42d"),l=a("2ac3"),h=a("de66"),p=a("8a39"),m=a("b82e"),f=a("0769"),g=a("a89b"),_=a("f20a"),y=a("8b68"),b=a("6ef5"),T=a("6c84"),C=a("a913"),S=a("3022"),A=a("03f1"),v=a("23b6"),x=a("7c5e"),E=a("dddf"),O=a("f1b3"),D=a("a307"),F=a("4c22");function w(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new n["a"](0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new i["a"],this.boundingVolumeSourceTile=void 0,this.boundingVolumeIsFromMesh=!1,this.terrainState=F["a"].UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new r["a"],this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}Object.defineProperties(w.prototype,{eligibleForUnloading:{get:function(){const e=this.terrainState,t=e===F["a"].RECEIVING||e===F["a"].TRANSFORMING;let a=!t;const r=this.imagery;for(let i=0,n=r.length;a&&i<n;++i){const e=r[i];a=!Object(s["a"])(e.loadingImagery)||e.loadingImagery.state!==E["a"].TRANSITIONING}return a}},renderedMesh:{get:function(){return Object(s["a"])(this.vertexArray)?this.mesh:Object(s["a"])(this.fill)?this.fill.mesh:void 0}}});const R=new o["a"];function L(e,t,a,r,n,o){let c=e.getExaggeratedPosition(r,n,o);if(Object(s["a"])(t)&&t!==D["a"].SCENE3D){const e=a.ellipsoid,t=e.cartesianToCartographic(c,R);c=a.project(t,o),c=i["a"].fromElements(c.z,c.x,c.y,o)}return c}const N=new i["a"],M=new i["a"],P=new i["a"];function I(e,t,a,r){const i=e.renderedMesh,n=i.vertices,o=i.encoding,s=n.length/o.stride;let c=f["a"].clone(o);c.hasGeodeticSurfaceNormals=t,c=f["a"].clone(c);const u=c.stride,d=new Float32Array(s*u);t?o.addGeodeticSurfaceNormals(n,d,a):o.removeGeodeticSurfaceNormals(n,d),i.vertices=d,i.stride=u;const l=i!==e.mesh;l?(w._freeVertexArray(e.fill.vertexArray),e.fill.vertexArray=w._createVertexArrayForMesh(r.context,i)):(w._freeVertexArray(e.vertexArray),e.vertexArray=w._createVertexArrayForMesh(r.context,i)),w._freeVertexArray(e.wireframeVertexArray),e.wireframeVertexArray=void 0}function B(e,t,a){let r=t.getTileDataAvailable(e.x,e.y,e.level);if(!Object(s["a"])(r)&&Object(s["a"])(e.parent)){const t=e.parent,a=t.data;Object(s["a"])(a)&&Object(s["a"])(a.terrainData)&&(r=a.terrainData.isChildAvailable(t.x,t.y,e.x,e.y))}!1===r&&(e.data.terrainState=F["a"].FAILED);for(let i=0,n=a.length;i<n;++i){const r=a.get(i);r.show&&r._createTileImagerySkeletons(e,t)}}function j(e,t,a,r,i,n){const o=e.data,c=e.parent;if(o.terrainState===F["a"].FAILED&&void 0!==c){const e=void 0!==c.data&&void 0!==c.data.terrainData&&!1!==c.data.terrainData.canUpsample;e||w.processStateMachine(c,t,a,r,i,n,!0)}if(o.terrainState===F["a"].FAILED&&H(o,e,t,a,e.x,e.y,e.level),o.terrainState===F["a"].UNLOADED&&k(o,a,e.x,e.y,e.level),o.terrainState===F["a"].RECEIVED&&G(o,t,a,e.x,e.y,e.level),o.terrainState===F["a"].TRANSFORMED&&(V(o,t.context,a,e.x,e.y,e.level,n),o.updateExaggeration(e,t,i)),o.terrainState>=F["a"].RECEIVED&&void 0===o.waterMaskTexture&&a.hasWaterMask){const a=o.terrainData;if(void 0!==a.waterMask)W(t.context,o);else{const t=o._findAncestorTileWithTerrainData(e);Object(s["a"])(t)&&Object(s["a"])(t.data.waterMaskTexture)&&(o.waterMaskTexture=t.data.waterMaskTexture,++o.waterMaskTexture.referenceCount,o._computeWaterMaskTranslationAndScale(e,t,o.waterMaskTranslationAndScale))}}}function H(e,t,a,r,i,n,o){const c=t.parent;if(!c)return void(t.state=O["a"].FAILED);const u=c.data.terrainData,d=c.x,l=c.y,h=c.level;if(!Object(s["a"])(u))return;const p=u.upsample(r.tilingScheme,d,l,h,i,n,o);Object(s["a"])(p)&&(e.terrainState=F["a"].RECEIVING,Promise.resolve(p).then((function(t){e.terrainData=t,e.terrainState=F["a"].RECEIVED})).catch((function(){e.terrainState=F["a"].FAILED})))}function k(e,t,a,r,i){function n(t){e.terrainData=t,e.terrainState=F["a"].RECEIVED,e.request=void 0}function o(n){if(e.request.state===p["a"].CANCELLED)return e.terrainData=void 0,e.terrainState=F["a"].UNLOADED,void(e.request=void 0);e.terrainState=F["a"].FAILED,e.request=void 0;const o=`Failed to obtain terrain tile X: ${a} Y: ${r} Level: ${i}. Error message: "${n}"`;t._requestError=g["a"].reportError(t._requestError,t,t.errorEvent,o,a,r,i),t._requestError.retry&&c()}function c(){const c=new h["a"]({throttle:!1,throttleByServer:!0,type:m["a"].TERRAIN});e.request=c;const u=t.requestTileGeometry(a,r,i,c);Object(s["a"])(u)?(e.terrainState=F["a"].RECEIVING,Promise.resolve(u).then((function(e){n(e)})).catch((function(e){o(e)}))):(e.terrainState=F["a"].UNLOADED,e.request=void 0)}c()}w.prototype.pick=function(e,t,a,r,i){const n=this.renderedMesh;if(!Object(s["a"])(n))return;const o=n.vertices,c=n.indices,d=n.encoding,h=c.length;let p=Number.MAX_VALUE;for(let l=0;l<h;l+=3){const i=c[l],n=c[l+1],h=c[l+2],m=L(d,t,a,o,i,N),f=L(d,t,a,o,n,M),g=L(d,t,a,o,h,P),_=u["a"].rayTriangleParametric(e,m,f,g,r);Object(s["a"])(_)&&_<p&&_>=0&&(p=_)}return p!==Number.MAX_VALUE?l["a"].getPoint(e,p,i):void 0},w.prototype.freeResources=function(){Object(s["a"])(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=F["a"].UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();const e=this.imagery;for(let t=0,a=e.length;t<a;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()},w.prototype.freeVertexArray=function(){w._freeVertexArray(this.vertexArray),this.vertexArray=void 0,w._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0},w.initialize=function(e,t,a){let r=e.data;Object(s["a"])(r)||(r=e.data=new w),e.state===O["a"].START&&(B(e,t,a),e.state=O["a"].LOADING)},w.processStateMachine=function(e,t,a,r,i,n,o){w.initialize(e,a,r);const c=e.data;if(e.state===O["a"].LOADING&&j(e,t,a,r,i,n),o)return;const u=e.renderable;e.renderable=Object(s["a"])(c.vertexArray);const d=c.terrainState===F["a"].READY;e.upsampledFromParent=Object(s["a"])(c.terrainData)&&c.terrainData.wasCreatedByUpsampling();const l=c.processImagery(e,a,t);if(d&&l){const t=e._loadedCallbacks,a={};for(const r in t)t.hasOwnProperty(r)&&(t[r](e)||(a[r]=t[r]));e._loadedCallbacks=a,e.state=O["a"].DONE}u&&(e.renderable=!0)},w.prototype.processImagery=function(e,t,a,r){const i=e.data;let n=e.upsampledFromParent,o=!1,c=!0;const u=i.imagery;let d,l;for(d=0,l=u.length;d<l;++d){const i=u[d];if(!Object(s["a"])(i.loadingImagery)){n=!1;continue}if(i.loadingImagery.state===E["a"].PLACEHOLDER){const a=i.loadingImagery.imageryLayer;if(a.imageryProvider.ready){i.freeResources(),u.splice(d,1),a._createTileImagerySkeletons(e,t,d),--d,l=u.length;continue}n=!1}const h=i.processStateMachine(e,a,r);c=c&&h,o=o||h||Object(s["a"])(i.readyImagery),n=n&&Object(s["a"])(i.loadingImagery)&&(i.loadingImagery.state===E["a"].FAILED||i.loadingImagery.state===E["a"].INVALID)}return e.upsampledFromParent=n,e.renderable=e.renderable&&(o||c),c},w.prototype.addGeodeticSurfaceNormals=function(e,t){I(this,!0,e,t)},w.prototype.removeGeodeticSurfaceNormals=function(e){I(this,!1,void 0,e)},w.prototype.updateExaggeration=function(e,t,a){const r=this,i=r.renderedMesh;if(void 0===i)return;const n=t.terrainExaggeration,o=t.terrainExaggerationRelativeHeight,s=1!==n,c=i.encoding,u=c.exaggeration!==n,d=c.exaggerationRelativeHeight!==o;if(u||d){if(u)if(s&&!c.hasGeodeticSurfaceNormals){const a=e.tilingScheme.ellipsoid;r.addGeodeticSurfaceNormals(a,t)}else!s&&c.hasGeodeticSurfaceNormals&&r.removeGeodeticSurfaceNormals(t);if(c.exaggeration=n,c.exaggerationRelativeHeight=o,void 0!==a){a._tileToUpdateHeights.push(e);const t=e.customData,r=t.length;for(let e=0;e<r;e++){const a=t[e];a.level=-1}}}};const U={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0,throttle:!0};function G(e,t,a,r,i,n){const o=a.tilingScheme,c=U;c.tilingScheme=o,c.x=r,c.y=i,c.level=n,c.exaggeration=t.terrainExaggeration,c.exaggerationRelativeHeight=t.terrainExaggerationRelativeHeight,c.throttle=!0;const u=e.terrainData,d=u.createMesh(c);Object(s["a"])(d)&&(e.terrainState=F["a"].TRANSFORMING,Promise.resolve(d).then((function(t){e.mesh=t,e.terrainState=F["a"].TRANSFORMED})).catch((function(){e.terrainState=F["a"].FAILED})))}function V(e,t,a,r,i,n,o){e.vertexArray=w._createVertexArrayForMesh(t,e.mesh),e.terrainState=F["a"].READY,e.fill=e.fill&&e.fill.destroy(o)}function z(e){let t=e.cache.tile_waterMaskData;if(!Object(s["a"])(t)){const a=C["a"].create({context:e,pixelFormat:d["a"].LUMINANCE,pixelDatatype:b["a"].UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});a.referenceCount=1;const r=new T["a"]({wrapS:v["a"].CLAMP_TO_EDGE,wrapT:v["a"].CLAMP_TO_EDGE,minificationFilter:A["a"].LINEAR,magnificationFilter:S["a"].LINEAR});t={allWaterTexture:a,sampler:r,destroy:function(){this.allWaterTexture.destroy()}},e.cache.tile_waterMaskData=t}return t}function W(e,t){const a=t.terrainData.waterMask,r=z(e);let i;const o=a.length;if(1===o){if(0===a[0])return;i=r.allWaterTexture}else{const t=Math.sqrt(o);i=C["a"].create({context:e,pixelFormat:d["a"].LUMINANCE,pixelDatatype:b["a"].UNSIGNED_BYTE,source:{width:t,height:t,arrayBufferView:a},sampler:r.sampler,flipY:!1}),i.referenceCount=0}++i.referenceCount,t.waterMaskTexture=i,n["a"].fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}w._createVertexArrayForMesh=function(e,t){const a=t.vertices,r=_["a"].createVertexBuffer({context:e,typedArray:a,usage:y["a"].STATIC_DRAW}),i=t.encoding.getAttributes(r),n=t.indices.indexBuffers||{};let o=n[e.id];if(!Object(s["a"])(o)||o.isDestroyed()){const a=t.indices;o=_["a"].createIndexBuffer({context:e,typedArray:a,usage:y["a"].STATIC_DRAW,indexDatatype:c["a"].fromSizeInBytes(a.BYTES_PER_ELEMENT)}),o.vertexArrayDestroyable=!1,o.referenceCount=1,n[e.id]=o,t.indices.indexBuffers=n}else++o.referenceCount;return new x["a"]({context:e,attributes:i,indexBuffer:o})},w._freeVertexArray=function(e){if(Object(s["a"])(e)){const t=e.indexBuffer;e.isDestroyed()||e.destroy(),Object(s["a"])(t)&&!t.isDestroyed()&&Object(s["a"])(t.referenceCount)&&(--t.referenceCount,0===t.referenceCount&&t.destroy())}},w.prototype._findAncestorTileWithTerrainData=function(e){let t=e.parent;while(Object(s["a"])(t)&&(!Object(s["a"])(t.data)||!Object(s["a"])(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling()))t=t.parent;return t},w.prototype._computeWaterMaskTranslationAndScale=function(e,t,a){const r=t.rectangle,i=e.rectangle,n=i.width,o=i.height,s=n/r.width,c=o/r.height;return a.x=s*(i.west-r.west)/n,a.y=c*(i.south-r.south)/o,a.z=s,a.w=c,a},t["a"]=w},3209:function(e,t,a){"use strict";var r=a("cef5"),i=a("b081"),n=a("670c"),o=a("be18"),s=a("a561"),c=a("bef8"),u=a("dc1c"),d=a("bd8d"),l=a("9541"),h=a("2bb9"),p=a("535a"),m=a("2f63"),f=a("7d62"),g=a("21d7"),_=a("d940"),y=a("c1e2"),b=a("0123"),T=a("66bf"),C=a("93da"),S=a("52f0"),A=a("6dfc"),v=a("78e5"),x=a("713f"),E=a("1b8d"),O=a("eace"),D=a("98f6"),F=a("c698"),w=a("fe57"),R=a("2368"),L=a("1184"),N=a("f20a"),M=a("8b68"),P=a("b997"),I=a("a894"),B=a("d289"),j=a("6dc0"),H=a("7c5e"),k=a("b7c8"),U=a("43ee"),G=a("06f0"),V=a("2856"),z=a("ad4a"),W=a("dddf"),Y=a("3a8e"),q=a("894b"),K=a("f1b3"),$=a("a307"),Q=a("c86b"),X=a("2221"),Z=a("4c22"),J=a("1ec0"),ee=a("ee78");function te(e){this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=Q["a"].RECEIVE_ONLY,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.undergroundColor=void 0,this.undergroundColorAlphaByDistance=void 0,this.lambertDiffuseMultiplier=0,this.materialUniformMap=void 0,this._materialUniformMap=void 0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new g["a"],this._imageryLayers.layerAdded.addEventListener(te.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(te.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(te.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(te.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new g["a"],this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new d["a"](0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=O["a"].clone(O["a"].MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1,this._oldTerrainExaggeration=void 0,this._oldTerrainExaggerationRelativeHeight=void 0}function ae(e,t){let a=e.loadingImagery;Object(m["a"])(a)||(a=e.readyImagery);let r=t.loadingImagery;return Object(m["a"])(r)||(r=t.readyImagery),a.imageryLayer._layerIndex-r.imageryLayer._layerIndex}function re(e,t){const a=t.creditDisplay;e._terrainProvider.ready&&Object(m["a"])(e._terrainProvider.credit)&&a.addCredit(e._terrainProvider.credit);const r=e._imageryLayers;for(let i=0,n=r.length;i<n;++i){const e=r.get(i).imageryProvider;e.ready&&Object(m["a"])(e.credit)&&a.addCredit(e.credit)}}function ie(e,t){const a=t.globeTranslucencyState;if(a.translucent){const r=e.renderState.blending.enabled;a.pushDerivedCommands(e,r,t)}else t.commandList.push(e)}Object.defineProperties(te.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){this._baseColor=e,this._firstPassInitialColor=s["a"].fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){this._quadtree=e}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){this._terrainProvider!==e&&(this._terrainProvider=e,Object(m["a"])(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){U["a"].setOwner(e,this,"_clippingPlanes")}}}),te.prototype.update=function(e){this._imageryLayers._update()},te.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(ae)}))),re(this,e);const t=this._vertexArraysToDestroy,a=t.length;for(let r=0;r<a;++r)V["a"]._freeVertexArray(t[r]);t.length=0},te.prototype.beginUpdate=function(e){const t=this._tilesToRenderByTextureCount;for(let r=0,i=t.length;r<i;++r){const e=t[r];Object(m["a"])(e)&&(e.length=0)}const a=this._clippingPlanes;Object(m["a"])(a)&&a.enabled&&a.update(e),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1},te.prototype.endUpdate=function(e){if(!Object(m["a"])(this._renderState)){this._renderState=j["a"].fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:G["a"].LESS}}),this._blendRenderState=j["a"].fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:G["a"].LESS_OR_EQUAL},blending:k["a"].ALPHA_BLEND});let e=Object(u["a"])(this._renderState,!0);e.cull.enabled=!1,this._disableCullingRenderState=j["a"].fromCache(e),e=Object(u["a"])(this._blendRenderState,!0),e.cull.enabled=!1,this._disableCullingBlendRenderState=j["a"].fromCache(e)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&X["a"].updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);const t=this.quadtree,a=e.terrainExaggeration,r=e.terrainExaggerationRelativeHeight,i=this._oldTerrainExaggeration!==a||this._oldTerrainExaggerationRelativeHeight!==r;this._oldTerrainExaggeration=a,this._oldTerrainExaggerationRelativeHeight=r,i&&t.forEachLoadedTile((function(a){const r=a.data;r.updateExaggeration(a,e,t)}));const n=this._tilesToRenderByTextureCount;for(let o=0,s=n.length;o<s;++o){const t=n[o];if(Object(m["a"])(t))for(let a=0,r=t.length;a<r;++a){const r=t[a],i=r.data.tileBoundingRegion;He(this,r,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,i.minimumHeight)}}},te.prototype.updateForPick=function(e){const t=this._drawCommands;for(let a=0,r=this._usedDrawCommands;a<r;++a)ie(t[a],e)},te.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()},te.prototype.getLevelMaximumGeometricError=function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)},te.prototype.loadTile=function(e,t){let a,r=t.data,i=!0;Object(m["a"])(r)&&(i=r.boundingVolumeSourceTile!==t||t._lastSelectionResult===ee["a"].CULLED_BUT_NEEDED,a=r.terrainState),V["a"].processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i),r=t.data,i&&a!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==R["a"].NONE&&r.boundingVolumeSourceTile===t&&(i=!1,V["a"].processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i))};const ne=new r["a"],oe=new O["a"],se=new O["a"],ce=new c["a"];function ue(e,t){if(t.west<t.east)return t;const a=O["a"].clone(t,se),r=O["a"].center(e,ce);return r.longitude>0?a.east=C["a"].PI:a.west=-C["a"].PI,a}function de(e,t){if(t.cameraUnderground)return!0;if(t.globeTranslucencyState.translucent)return!0;if(e.backFaceCulling)return!1;const a=e._clippingPlanes;return!(!Object(m["a"])(a)||!a.enabled)||!O["a"].equals(e.cartographicLimitRectangle,O["a"].MAX_VALUE)}te.prototype.computeTileVisibility=function(e,t,a){const i=this.computeDistanceToTile(e,t);e._distance=i;const n=de(this,t);if(t.fog.enabled&&!n&&C["a"].fog(i,t.fog.density)>=1)return R["a"].NONE;const s=e.data,c=s.tileBoundingRegion;if(void 0===s.boundingVolumeSourceTile)return R["a"].PARTIAL;const u=t.cullingVolume;let d=c.boundingVolume;Object(m["a"])(d)||(d=c.boundingSphere),s.clippedByBoundaries=!1;const l=ue(e.rectangle,this.cartographicLimitRectangle),h=O["a"].simpleIntersection(l,e.rectangle,oe);if(!Object(m["a"])(h))return R["a"].NONE;if(O["a"].equals(h,e.rectangle)||(s.clippedByBoundaries=!0),t.mode!==$["a"].SCENE3D&&(d=ne,r["a"].fromRectangleWithHeights2D(e.rectangle,t.mapProjection,c.minimumHeight,c.maximumHeight,d),o["a"].fromElements(d.center.z,d.center.x,d.center.y,d.center),t.mode===$["a"].MORPHING&&Object(m["a"])(s.renderedMesh)&&(d=r["a"].union(c.boundingSphere,d,d))),!Object(m["a"])(d))return R["a"].PARTIAL;const p=this._clippingPlanes;if(Object(m["a"])(p)&&p.enabled){const t=p.computeIntersectionWithBoundingVolume(d);if(e.isClipped=t!==T["a"].INSIDE,t===T["a"].OUTSIDE)return R["a"].NONE}let f;const g=u.computeVisibility(d);if(g===T["a"].OUTSIDE?f=R["a"].NONE:g===T["a"].INTERSECTING?f=R["a"].PARTIAL:g===T["a"].INSIDE&&(f=R["a"].FULL),f===R["a"].NONE)return f;const _=t.mode===$["a"].SCENE3D&&t.camera.frustum instanceof x["a"];if(t.mode===$["a"].SCENE3D&&!_&&Object(m["a"])(a)&&!n){const e=s.occludeePointInScaledSpace;return Object(m["a"])(e)?a.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(e,c.minimumHeight)?f:R["a"].NONE:f}return f},te.prototype.canRefine=function(e){if(Object(m["a"])(e.data.terrainData))return!0;const t=this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1);return void 0!==t};const le=[],he=[];te.prototype.canRenderWithoutLosingDetail=function(e,t){const a=e.data,r=le;r.length=this._imageryLayers.length;let i,n,o,s=!1,c=!1;for(Object(m["a"])(a)&&(s=a.terrainState===Z["a"].READY,c=!0,i=a.imagery),n=0,o=r.length;n<o;++n)r[n]=c;if(Object(m["a"])(i))for(n=0,o=i.length;n<o;++n){const e=i[n],t=e.loadingImagery,a=!Object(m["a"])(t)||t.state===W["a"].FAILED||t.state===W["a"].INVALID,o=(e.loadingImagery||e.readyImagery).imageryLayer._layerIndex;r[o]=a&&r[o]}const u=this.quadtree._lastSelectionFrameNumber,d=he;d.length=0,d.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);while(d.length>0){const e=d.pop(),t=e._lastSelectionResultFrame===u?e._lastSelectionResult:ee["a"].NONE;if(t===ee["a"].RENDERED){const t=e.data;if(!Object(m["a"])(t))continue;if(!s&&e.data.terrainState===Z["a"].READY)return!1;const a=e.data.imagery;for(n=0,o=a.length;n<o;++n){const e=a[n],t=e.loadingImagery,i=!Object(m["a"])(t)||t.state===W["a"].FAILED||t.state===W["a"].INVALID,o=(e.loadingImagery||e.readyImagery).imageryLayer._layerIndex;if(i&&!r[o])return!1}}else t===ee["a"].REFINED&&d.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild)}return!0};const pe=new o["a"];te.prototype.computeTileLoadPriority=function(e,t){const a=e.data;if(void 0===a)return 0;const r=a.tileBoundingRegion.boundingVolume;if(void 0===r)return 0;const i=t.camera.positionWC,n=t.camera.directionWC,s=o["a"].subtract(r.center,i,pe),c=o["a"].magnitude(s);return c<C["a"].EPSILON5?0:(o["a"].divideByScalar(s,c,s),(1-o["a"].dot(s,n))*e._distance)};const me=new S["a"],fe=new S["a"],ge=new s["a"],_e=new s["a"],ye=new s["a"],be=new o["a"],Te=new o["a"],Ce=new o["a"],Se=new o["a"];te.prototype.showTileThisFrame=function(e,t){let a=0;const r=e.data.imagery;for(let s=0,c=r.length;s<c;++s){const e=r[s];Object(m["a"])(e.readyImagery)&&0!==e.readyImagery.imageryLayer.alpha&&++a}let i=this._tilesToRenderByTextureCount[a];Object(m["a"])(i)||(i=[],this._tilesToRenderByTextureCount[a]=i),i.push(e);const n=e.data;Object(m["a"])(n.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;const o=this._debug;++o.tilesRendered,o.texturesRendered+=a};const Ae=[new o["a"],new o["a"],new o["a"],new o["a"]];function ve(e,t,a,r,i,n){const s=e.quadtree._occluders.ellipsoid,c=s.ellipsoid,u=Ae;return o["a"].fromRadians(a.west,a.south,i,c,u[0]),o["a"].fromRadians(a.east,a.south,i,c,u[1]),o["a"].fromRadians(a.west,a.north,i,c,u[2]),o["a"].fromRadians(a.east,a.north,i,c,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,r,n)}function xe(e,t,a){let i=e.data;void 0===i&&(i=e.data=new V["a"]);const n=e.tilingScheme.ellipsoid;void 0===i.tileBoundingRegion&&(i.tileBoundingRegion=new J["a"]({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:n,minimumHeight:0,maximumHeight:0}));const s=i.tileBoundingRegion,c=s.minimumHeight,u=s.maximumHeight;let d=!1,l=e;const h=i.mesh,p=i.terrainData;if(void 0!==h&&void 0!==h.minimumHeight&&void 0!==h.maximumHeight)s.minimumHeight=h.minimumHeight,s.maximumHeight=h.maximumHeight,d=!0;else if(void 0!==p&&void 0!==p._minimumHeight&&void 0!==p._maximumHeight)s.minimumHeight=p._minimumHeight,s.maximumHeight=p._maximumHeight;else{s.minimumHeight=Number.NaN,s.maximumHeight=Number.NaN;let t=e.parent;while(void 0!==t){const e=t.data;if(void 0!==e){const t=e.mesh,a=e.terrainData;if(void 0!==t&&void 0!==t.minimumHeight&&void 0!==t.maximumHeight){s.minimumHeight=t.minimumHeight,s.maximumHeight=t.maximumHeight;break}if(void 0!==a&&void 0!==a._minimumHeight&&void 0!==a._maximumHeight){s.minimumHeight=a._minimumHeight,s.maximumHeight=a._maximumHeight;break}}t=t.parent}l=t}if(void 0!==l){const p=a.terrainExaggeration,f=a.terrainExaggerationRelativeHeight,g=1!==p;if(g&&(d=!1,s.minimumHeight=F["a"].getHeight(s.minimumHeight,p,f),s.maximumHeight=F["a"].getHeight(s.maximumHeight,p,f)),d)i.boundingVolumeIsFromMesh||(s._orientedBoundingBox=v["a"].clone(h.orientedBoundingBox,s._orientedBoundingBox),s._boundingSphere=r["a"].clone(h.boundingSphere3D,s._boundingSphere),i.occludeePointInScaledSpace=o["a"].clone(h.occludeePointInScaledSpace,i.occludeePointInScaledSpace),Object(m["a"])(i.occludeePointInScaledSpace)||(i.occludeePointInScaledSpace=ve(t,s._orientedBoundingBox.center,e.rectangle,s.minimumHeight,s.maximumHeight,i.occludeePointInScaledSpace)));else{const a=void 0===s._orientedBoundingBox||void 0===s._boundingSphere,r=s.minimumHeight!==c||s.maximumHeight!==u;(r||a)&&(s.computeBoundingVolumes(n),i.occludeePointInScaledSpace=ve(t,s._orientedBoundingBox.center,e.rectangle,s.minimumHeight,s.maximumHeight,i.occludeePointInScaledSpace))}i.boundingVolumeSourceTile=l,i.boundingVolumeIsFromMesh=d}else i.boundingVolumeSourceTile=void 0,i.boundingVolumeIsFromMesh=!1}function Ee(e,t,a){return function(r){let i,n,o=-1;const s=r.data.imagery,c=s.length;let u;for(u=0;u<c;++u)if(i=s[u],n=Object(p["a"])(i.readyImagery,i.loadingImagery),n.imageryLayer===t){o=u;break}if(-1!==o){const c=o+e;if(i=s[c],n=Object(m["a"])(i)?Object(p["a"])(i.readyImagery,i.loadingImagery):void 0,!Object(m["a"])(n)||n.imageryLayer!==t)return!t._createTileImagerySkeletons(r,a,c);for(u=o;u<c;++u)s[u].freeResources();s.splice(o,e)}return!0}}te.prototype.computeDistanceToTile=function(e,t){xe(e,this,t);const a=e.data,r=a.boundingVolumeSourceTile;if(void 0===r)return 9999999999;const i=a.tileBoundingRegion,n=i.minimumHeight,o=i.maximumHeight;if(a.boundingVolumeSourceTile!==e){const e=t.camera.positionCartographic.height,a=Math.abs(e-n),r=Math.abs(e-o);a>r?(i.minimumHeight=n,i.maximumHeight=n):(i.minimumHeight=o,i.maximumHeight=o)}const s=i.distanceToCamera(t);return i.minimumHeight=n,i.maximumHeight=o,s},te.prototype.isDestroyed=function(){return!1},te.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Object(f["a"])(this)},te.prototype._onLayerAdded=function(e,t){if(e.show){const t=this._terrainProvider,a=this,r=e.imageryProvider,i=this._imageryLayersUpdatedEvent;r._reload=function(){e._imageryCache={},a._quadtree.forEachLoadedTile((function(a){if(Object(m["a"])(a._loadedCallbacks[e._layerIndex]))return;let r;const i=a.data.imagery,n=i.length;let o=-1,s=0;for(r=0;r<n;++r){const t=i[r],a=Object(p["a"])(t.readyImagery,t.loadingImagery);if(a.imageryLayer===e)-1===o&&(o=r),++s;else if(-1!==o)break}if(-1===o)return;const c=o+s;e._createTileImagerySkeletons(a,t,c)&&(a._loadedCallbacks[e._layerIndex]=Ee(s,e,t),a.state=K["a"].LOADING)}))},this._quadtree.forEachLoadedTile((function(r){e._createTileImagerySkeletons(r,t)&&(r.state=K["a"].LOADING,0===r.level||r._lastSelectionResultFrame===a.quadtree._lastSelectionFrameNumber&&r._lastSelectionResult===ee["a"].RENDERED||(r.renderable=!1))})),this._layerOrderChanged=!0,i.raiseEvent()}},te.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile((function(t){const a=t.data.imagery;let r=-1,i=0;for(let n=0,o=a.length;n<o;++n){const t=a[n];let o=t.loadingImagery;if(Object(m["a"])(o)||(o=t.readyImagery),o.imageryLayer===e)-1===r&&(r=n),t.freeResources(),++i;else if(-1!==r)break}-1!==r&&a.splice(r,i)})),Object(m["a"])(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()},te.prototype._onLayerMoved=function(e,t,a){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()},te.prototype._onLayerShownOrHidden=function(e,t,a){a?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};const Oe=new S["a"],De=new S["a"];function Fe(e,t){const a={u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_atmosphereLightIntensity:function(){return this.properties.atmosphereLightIntensity},u_atmosphereRayleighCoefficient:function(){return this.properties.atmosphereRayleighCoefficient},u_atmosphereMieCoefficient:function(){return this.properties.atmosphereMieCoefficient},u_atmosphereRayleighScaleHeight:function(){return this.properties.atmosphereRayleighScaleHeight},u_atmosphereMieScaleHeight:function(){return this.properties.atmosphereMieScaleHeight},u_atmosphereMieAnisotropy:function(){return this.properties.atmosphereMieAnisotropy},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_terrainExaggerationAndRelativeHeight:function(){return this.properties.terrainExaggerationAndRelativeHeight},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){const t=e.context.uniformState.view,a=S["a"].multiplyByPoint(t,this.properties.rtc,Te);return S["a"].setTranslation(t,a,me),me},u_modifiedModelViewProjection:function(){const t=e.context.uniformState.view,a=e.context.uniformState.projection,r=S["a"].multiplyByPoint(t,this.properties.rtc,Te);return S["a"].setTranslation(t,r,fe),S["a"].multiply(a,fe,fe),fe},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureNightAlpha:function(){return this.properties.dayTextureNightAlpha},u_dayTextureDayAlpha:function(){return this.properties.dayTextureDayAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){const a=t._clippingPlanes;return Object(m["a"])(a)&&Object(m["a"])(a.texture)?a.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){const a=t._clippingPlanes,r=Object(m["a"])(a)?S["a"].multiply(e.context.uniformState.view,a.modelMatrix,Oe):S["a"].IDENTITY;return S["a"].inverseTranspose(r,De)},u_clippingPlanesEdgeStyle:function(){const e=this.properties.clippingPlanesEdgeColor;return e.alpha=this.properties.clippingPlanesEdgeWidth,e},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},u_frontFaceAlphaByDistance:function(){return this.properties.frontFaceAlphaByDistance},u_backFaceAlphaByDistance:function(){return this.properties.backFaceAlphaByDistance},u_translucencyRectangle:function(){return this.properties.localizedTranslucencyRectangle},u_undergroundColor:function(){return this.properties.undergroundColor},u_undergroundColorAlphaByDistance:function(){return this.properties.undergroundColorAlphaByDistance},u_lambertDiffuseMultiplier:function(){return this.properties.lambertDiffuseMultiplier},properties:{initialColor:new s["a"](0,0,.5,1),fillHighlightColor:new d["a"](0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new n["a"](65e5,9e6),nightFadeDistance:new n["a"](1e7,4e7),atmosphereLightIntensity:10,atmosphereRayleighCoefficient:new o["a"](55e-7,13e-6,284e-7),atmosphereMieCoefficient:new o["a"](21e-6,21e-6,21e-6),atmosphereRayleighScaleHeight:1e4,atmosphereMieScaleHeight:3200,atmosphereMieAnisotropy:.9,hsbShift:new o["a"],center3D:void 0,rtc:new o["a"],modifiedModelView:new S["a"],tileRectangle:new s["a"],terrainExaggerationAndRelativeHeight:new n["a"](1,0),dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new n["a"],southMercatorYAndOneOverHeight:new n["a"],waterMask:void 0,waterMaskTranslationAndScale:new s["a"],minMaxHeight:new n["a"],scaleAndBias:new S["a"],clippingPlanesEdgeColor:d["a"].clone(d["a"].WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new s["a"],frontFaceAlphaByDistance:new s["a"],backFaceAlphaByDistance:new s["a"],localizedTranslucencyRectangle:new s["a"],undergroundColor:d["a"].clone(d["a"].TRANSPARENT),undergroundColorAlphaByDistance:new s["a"],lambertDiffuseMultiplier:0}};return Object(m["a"])(t.materialUniformMap)?Object(h["a"])(a,t.materialUniformMap):a}function we(e,t,a){const r=a.data;let i,n;if(Object(m["a"])(r.vertexArray)?(i=r.mesh,n=r.vertexArray):Object(m["a"])(r.fill)&&Object(m["a"])(r.fill.vertexArray)&&(i=r.fill.mesh,n=r.fill.vertexArray),Object(m["a"])(i)&&Object(m["a"])(n)){if(Object(m["a"])(r.wireframeVertexArray)){if(r.wireframeVertexArray.mesh===i)return;r.wireframeVertexArray.destroy(),r.wireframeVertexArray=void 0}r.wireframeVertexArray=Re(e,n,i),r.wireframeVertexArray.mesh=i}}function Re(e,t,a){const r=a.indices,i={indices:r,primitiveType:E["a"].TRIANGLES};y["a"].toWireframe(i);const n=i.indices,o=N["a"].createIndexBuffer({context:e,typedArray:n,usage:M["a"].STATIC_DRAW,indexDatatype:b["a"].fromSizeInBytes(n.BYTES_PER_ELEMENT)});return new H["a"]({context:e,attributes:t._attributes,indexBuffer:o})}let Le,Ne,Me;(function(){const e=new _["a"]({geometry:i["a"].fromDimensions({dimensions:new o["a"](2,2,2)})}),t=new _["a"]({geometry:new D["a"]({radius:1})});let a,r,n=new S["a"];function s(e){return new q["a"]({geometryInstances:e,appearance:new Y["a"]({translucent:!1,flat:!0}),asynchronous:!1})}Le=function(t,i){return t===a||(Me(),a=t,n=S["a"].fromRotationTranslation(t.halfAxes,t.center,n),e.modelMatrix=n,e.attributes.color=l["a"].fromColor(i),r=s(e)),r},Ne=function(e,i){return e===a||(Me(),a=e,n=S["a"].fromTranslation(e.center,n),n=S["a"].multiplyByUniformScale(n,e.radius,n),t.modelMatrix=n,t.attributes.color=l["a"].fromColor(i),r=s(t)),r},Me=function(){Object(m["a"])(r)&&(r.destroy(),r=void 0,a=void 0)}})();const Pe=new s["a"](0,0,0,0),Ie={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0,hasGeodeticSurfaceNormals:void 0,hasExaggeration:void 0},Be=d["a"].TRANSPARENT,je=new A["a"];function He(e,t,a){const i=t.data;Object(m["a"])(i.vertexArray)||(void 0===i.fill&&(i.fill=new X["a"](t)),i.fill.update(e,a));const n=a.creditDisplay,c=i.terrainData;if(Object(m["a"])(c)&&Object(m["a"])(c.credits)){const e=c.credits;for(let t=0,a=e.length;t<a;++t)n.addCredit(e[t])}let u=P["a"].maximumTextureImageUnits,l=i.waterMaskTexture,h=i.waterMaskTranslationAndScale;!Object(m["a"])(l)&&Object(m["a"])(i.fill)&&(l=i.fill.waterMaskTexture,h=i.fill.waterMaskTranslationAndScale);const f=a.cameraUnderground,g=a.globeTranslucencyState,_=g.translucent,y=g.frontFaceAlphaByDistance,b=g.backFaceAlphaByDistance,T=g.rectangle,A=Object(p["a"])(e.undergroundColor,Be),x=Object(p["a"])(e.undergroundColorAlphaByDistance,je),D=de(e,a)&&a.mode===$["a"].SCENE3D&&A.alpha>0&&(x.nearValue>0||x.farValue>0),F=e.lambertDiffuseMultiplier,R=e.hasWaterMask&&Object(m["a"])(l),N=e.oceanNormalMap,M=R&&Object(m["a"])(N),j=e.terrainProvider.ready&&e.terrainProvider.hasVertexNormals,H=a.fog.enabled&&a.fog.renderable&&!f,k=e.showGroundAtmosphere&&a.mode===$["a"].SCENE3D,U=Q["a"].castShadows(e.shadows)&&!_,G=Q["a"].receiveShadows(e.shadows)&&!_,V=e.hueShift,W=e.saturationShift,Y=e.brightnessShift;let q=!(C["a"].equalsEpsilon(V,0,C["a"].EPSILON7)&&C["a"].equalsEpsilon(W,0,C["a"].EPSILON7)&&C["a"].equalsEpsilon(Y,0,C["a"].EPSILON7)),K=!1;if(k){const t=o["a"].magnitude(a.camera.positionWC),r=e.nightFadeOutDistance;K=t>r}R&&--u,M&&--u,Object(m["a"])(a.shadowState)&&a.shadowState.shadowsEnabled&&--u,Object(m["a"])(e.clippingPlanes)&&e.clippingPlanes.enabled&&--u,u-=g.numberOfTextureUniforms;const Z=i.renderedMesh;let J=Z.center;const ee=Z.encoding,te=i.tileBoundingRegion,ae=a.terrainExaggeration,re=a.terrainExaggerationRelativeHeight,ne=1!==ae,se=ee.hasGeodeticSurfaceNormals,ce=ge;let le=0,he=0,pe=0,me=0,fe=!1;if(a.mode!==$["a"].SCENE3D){const e=a.mapProjection,r=e.project(O["a"].southwest(t.rectangle),Ce),i=e.project(O["a"].northeast(t.rectangle),Se);if(ce.x=r.x,ce.y=r.y,ce.z=i.x,ce.w=i.y,a.mode!==$["a"].MORPHING&&(J=be,J.x=0,J.y=.5*(ce.z+ce.x),J.z=.5*(ce.w+ce.y),ce.x-=J.y,ce.y-=J.z,ce.z-=J.y,ce.w-=J.z),a.mode===$["a"].SCENE2D&&ee.quantization===w["a"].BITS12){const e=1/(Math.pow(2,12)-1)*.5,t=(ce.z-ce.x)*e,a=(ce.w-ce.y)*e;ce.x-=t,ce.y-=a,ce.z+=t,ce.w+=a}e instanceof L["a"]&&(le=t.rectangle.south,he=t.rectangle.north,pe=L["a"].geodeticLatitudeToMercatorAngle(le),me=1/(L["a"].geodeticLatitudeToMercatorAngle(he)-pe),fe=!0)}const Te=Ie;Te.frameState=a,Te.surfaceTile=i,Te.showReflectiveOcean=R,Te.showOceanWaves=M,Te.enableLighting=e.enableLighting,Te.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,Te.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,Te.showGroundAtmosphere=k,Te.atmosphereLightIntensity=e.atmosphereLightIntensity,Te.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,Te.atmosphereMieCoefficient=e.atmosphereMieCoefficient,Te.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,Te.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,Te.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,Te.perFragmentGroundAtmosphere=K,Te.hasVertexNormals=j,Te.useWebMercatorProjection=fe,Te.clippedByBoundaries=i.clippedByBoundaries,Te.hasGeodeticSurfaceNormals=se,Te.hasExaggeration=ne;const Ae=i.imagery;let ve=0;const xe=Ae.length,Ee=e.showSkirts&&!f&&!_,Oe=e.backFaceCulling&&!f&&!_,De=Oe?e._renderState:e._disableCullingRenderState,Re=Oe?e._blendRenderState:e._disableCullingBlendRenderState;let He=De,ke=e._firstPassInitialColor;const Ue=a.context;Object(m["a"])(e._debug.boundingSphereTile)||Me();const Ge=e._materialUniformMap!==e.materialUniformMap;if(Ge){e._materialUniformMap=e.materialUniformMap;const t=e._drawCommands.length;for(let r=0;r<t;++r)e._uniformMaps[r]=Fe(a,e)}do{let c,p,w=0;if(e._drawCommands.length<=e._usedDrawCommands?(c=new I["a"],c.owner=t,c.cull=!1,c.boundingVolume=new r["a"],c.orientedBoundingBox=void 0,p=Fe(a,e),e._drawCommands.push(c),e._uniformMaps.push(p)):(c=e._drawCommands[e._usedDrawCommands],p=e._uniformMaps[e._usedDrawCommands]),c.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){const e=te.boundingVolume,t=te.boundingSphere;Object(m["a"])(e)?Le(e,d["a"].RED).update(a):Object(m["a"])(t)&&Ne(t,d["a"].RED).update(a)}const R=p.properties;s["a"].clone(ke,R.initialColor),R.oceanNormalMap=N,R.lightingFadeDistance.x=e.lightingFadeOutDistance,R.lightingFadeDistance.y=e.lightingFadeInDistance,R.nightFadeDistance.x=e.nightFadeOutDistance,R.nightFadeDistance.y=e.nightFadeInDistance,R.atmosphereLightIntensity=e.atmosphereLightIntensity,R.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,R.atmosphereMieCoefficient=e.atmosphereMieCoefficient,R.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,R.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,R.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,R.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;const L=f?b:y,M=f?y:b;Object(m["a"])(L)&&(s["a"].fromElements(L.near,L.nearValue,L.far,L.farValue,R.frontFaceAlphaByDistance),s["a"].fromElements(M.near,M.nearValue,M.far,M.farValue,R.backFaceAlphaByDistance)),s["a"].fromElements(x.near,x.nearValue,x.far,x.farValue,R.undergroundColorAlphaByDistance),d["a"].clone(A,R.undergroundColor),R.lambertDiffuseMultiplier=F;const P=!Object(m["a"])(i.vertexArray)&&Object(m["a"])(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;P&&d["a"].clone(e.fillHighlightColor,R.fillHighlightColor),R.terrainExaggerationAndRelativeHeight.x=ae,R.terrainExaggerationAndRelativeHeight.y=re,R.center3D=Z.center,o["a"].clone(J,R.rtc),s["a"].clone(ce,R.tileRectangle),R.southAndNorthLatitude.x=le,R.southAndNorthLatitude.y=he,R.southMercatorYAndOneOverHeight.x=pe,R.southMercatorYAndOneOverHeight.y=me;const j=_e,K=ue(t.rectangle,e.cartographicLimitRectangle),Q=ye,X=ue(t.rectangle,T);o["a"].fromElements(V,W,Y,R.hsbShift);const ne=t.rectangle,se=1/ne.width,de=1/ne.height;j.x=(K.west-ne.west)*se,j.y=(K.south-ne.south)*de,j.z=(K.east-ne.west)*se,j.w=(K.north-ne.south)*de,s["a"].clone(j,R.localizedCartographicLimitRectangle),Q.x=(X.west-ne.west)*se,Q.y=(X.south-ne.south)*de,Q.z=(X.east-ne.west)*se,Q.w=(X.north-ne.south)*de,s["a"].clone(Q,R.localizedTranslucencyRectangle);const fe=H&&C["a"].fog(t._distance,a.fog.density)>C["a"].EPSILON3;q=q&&(fe||k);let ge=!1,be=!1,Ce=!1,Se=!1,Oe=!1,De=!1,Me=!1,Ie=!1,Be=!1,je=!1;while(w<u&&ve<xe){const e=Ae[ve],a=e.readyImagery;if(++ve,!Object(m["a"])(a)||0===a.imageryLayer.alpha)continue;const r=e.useWebMercatorT?a.textureWebMercator:a.texture,i=a.imageryLayer;Object(m["a"])(e.textureTranslationAndScale)||(e.textureTranslationAndScale=i._calculateTextureTranslationAndScale(t,e)),R.dayTextures[w]=r,R.dayTextureTranslationAndScale[w]=e.textureTranslationAndScale,R.dayTextureTexCoordsRectangle[w]=e.textureCoordinateRectangle,R.dayTextureUseWebMercatorT[w]=e.useWebMercatorT,R.dayTextureAlpha[w]=i.alpha,De=De||1!==R.dayTextureAlpha[w],R.dayTextureNightAlpha[w]=i.nightAlpha,Me=Me||1!==R.dayTextureNightAlpha[w],R.dayTextureDayAlpha[w]=i.dayAlpha,Me=Me||1!==R.dayTextureDayAlpha[w],R.dayTextureBrightness[w]=i.brightness,ge=ge||R.dayTextureBrightness[w]!==z["a"].DEFAULT_BRIGHTNESS,R.dayTextureContrast[w]=i.contrast,be=be||R.dayTextureContrast[w]!==z["a"].DEFAULT_CONTRAST,R.dayTextureHue[w]=i.hue,Ce=Ce||R.dayTextureHue[w]!==z["a"].DEFAULT_HUE,R.dayTextureSaturation[w]=i.saturation,Se=Se||R.dayTextureSaturation[w]!==z["a"].DEFAULT_SATURATION,R.dayTextureOneOverGamma[w]=1/i.gamma,Oe=Oe||R.dayTextureOneOverGamma[w]!==1/z["a"].DEFAULT_GAMMA,R.dayTextureSplit[w]=i.splitDirection,Ie=Ie||0!==R.dayTextureSplit[w];let o=R.dayTextureCutoutRectangles[w];if(Object(m["a"])(o)||(o=R.dayTextureCutoutRectangles[w]=new s["a"]),s["a"].clone(s["a"].ZERO,o),Object(m["a"])(i.cutoutRectangle)){const e=ue(ne,i.cutoutRectangle),t=O["a"].simpleIntersection(e,ne,oe);Be=Object(m["a"])(t)||Be,o.x=(e.west-ne.west)*se,o.y=(e.south-ne.south)*de,o.z=(e.east-ne.west)*se,o.w=(e.north-ne.south)*de}let c=R.colorsToAlpha[w];Object(m["a"])(c)||(c=R.colorsToAlpha[w]=new s["a"]);const u=Object(m["a"])(i.colorToAlpha)&&i.colorToAlphaThreshold>0;if(je=je||u,u){const e=i.colorToAlpha;c.x=e.red,c.y=e.green,c.z=e.blue,c.w=i.colorToAlphaThreshold}else c.w=-1;if(Object(m["a"])(a.credits)){const e=a.credits;for(let t=0,a=e.length;t<a;++t)n.addCredit(e[t])}++w}R.dayTextures.length=w,R.waterMask=l,s["a"].clone(h,R.waterMaskTranslationAndScale),R.minMaxHeight.x=ee.minimumHeight,R.minMaxHeight.y=ee.maximumHeight,S["a"].clone(ee.matrix,R.scaleAndBias);const Ge=e._clippingPlanes,Ve=Object(m["a"])(Ge)&&Ge.enabled&&t.isClipped;Ve&&(R.clippingPlanesEdgeColor=d["a"].clone(Ge.edgeColor,R.clippingPlanesEdgeColor),R.clippingPlanesEdgeWidth=Ge.edgeWidth),Te.numberOfDayTextures=w,Te.applyBrightness=ge,Te.applyContrast=be,Te.applyHue=Ce,Te.applySaturation=Se,Te.applyGamma=Oe,Te.applyAlpha=De,Te.applyDayNightAlpha=Me,Te.applySplit=Ie,Te.enableFog=fe,Te.enableClippingPlanes=Ve,Te.clippingPlanes=Ge,Te.hasImageryLayerCutout=Be,Te.colorCorrect=q,Te.highlightFillTile=P,Te.colorToAlpha=je,Te.showUndergroundColor=D,Te.translucent=_;let ze=i.renderedMesh.indices.length;Ee||(ze=i.renderedMesh.indexCountWithoutSkirts),c.shaderProgram=e._surfaceShaderSet.getShaderProgram(Te),c.castShadows=U,c.receiveShadows=G,c.renderState=He,c.primitiveType=E["a"].TRIANGLES,c.vertexArray=i.vertexArray||i.fill.vertexArray,c.count=ze,c.uniformMap=p,c.pass=B["a"].GLOBE,e._debug.wireframe&&(we(Ue,e,t),Object(m["a"])(i.wireframeVertexArray)&&(c.vertexArray=i.wireframeVertexArray,c.primitiveType=E["a"].LINES,c.count=2*ze));let We=c.boundingVolume;const Ye=c.orientedBoundingBox;a.mode!==$["a"].SCENE3D?(r["a"].fromRectangleWithHeights2D(t.rectangle,a.mapProjection,te.minimumHeight,te.maximumHeight,We),o["a"].fromElements(We.center.z,We.center.x,We.center.y,We.center),a.mode===$["a"].MORPHING&&(We=r["a"].union(te.boundingSphere,We,We))):(c.boundingVolume=r["a"].clone(te.boundingSphere,We),c.orientedBoundingBox=v["a"].clone(te.boundingVolume,Ye)),c.dirty=!0,_&&g.updateDerivedCommands(c,a),ie(c,a),He=Re,ke=Pe}while(ve<xe)}t["a"]=te},5225:function(e,t,a){"use strict";var r=a("2f63"),i=a("6dfc"),n=a("eace");function o(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=n["a"].clone(n["a"].MAX_VALUE)}Object.defineProperties(o.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){this._frontFaceAlphaByDistance=i["a"].clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){this._backFaceAlphaByDistance=i["a"].clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(e){Object(r["a"])(e)||(e=n["a"].clone(n["a"].MAX_VALUE)),n["a"].clone(e,this._rectangle)}}}),t["a"]=o},"6b72":function(e,t,a){"use strict";var r=a("2bb9"),i=a("535a"),n=a("2f63"),o=a("6dfc"),s=a("eace"),c=a("a894"),u=a("d289"),d=a("6dc0"),l=a("5770"),h=a("b7c8"),p=a("29ab"),m=a("a307");const f={OPAQUE_FRONT_FACE:0,OPAQUE_BACK_FACE:1,DEPTH_ONLY_FRONT_FACE:2,DEPTH_ONLY_BACK_FACE:3,DEPTH_ONLY_FRONT_AND_BACK_FACE:4,TRANSLUCENT_FRONT_FACE:5,TRANSLUCENT_BACK_FACE:6,TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:7,TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:8,PICK_FRONT_FACE:9,PICK_BACK_FACE:10,DERIVED_COMMANDS_MAXIMUM_LENGTH:11},g=f.DERIVED_COMMANDS_MAXIMUM_LENGTH,_=["opaqueFrontFaceCommand","opaqueBackFaceCommand","depthOnlyFrontFaceCommand","depthOnlyBackFaceCommand","depthOnlyFrontAndBackFaceCommand","translucentFrontFaceCommand","translucentBackFaceCommand","translucentFrontFaceManualDepthTestCommand","translucentBackFaceManualDepthTestCommand","pickFrontFaceCommand","pickBackFaceCommand"];function y(){this._frontFaceAlphaByDistance=new o["a"](0,1,0,1),this._backFaceAlphaByDistance=new o["a"](0,1,0,1),this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._requiresManualDepthTest=!1,this._sunVisibleThroughGlobe=!1,this._environmentVisible=!1,this._useDepthPlane=!1,this._numberOfTextureUniforms=0,this._globeTranslucencyFramebuffer=void 0,this._rectangle=s["a"].clone(s["a"].MAX_VALUE),this._derivedCommandKey=0,this._derivedCommandsDirty=!1,this._derivedCommandPacks=void 0,this._derivedCommandTypes=new Array(g),this._derivedBlendCommandTypes=new Array(g),this._derivedPickCommandTypes=new Array(g),this._derivedCommandTypesToUpdate=new Array(g),this._derivedCommandsLength=0,this._derivedBlendCommandsLength=0,this._derivedPickCommandsLength=0,this._derivedCommandsToUpdateLength=0}function b(e,t,a,r){return e?Object(n["a"])(a)?(o["a"].clone(a,r),r.nearValue*=t,r.farValue*=t,r):(r.nearValue=t,r.farValue=t,r):(r.nearValue=1,r.farValue=1,r)}function T(e,t,a){return e&&(a.baseColor.alpha<1||t.nearValue<1||t.farValue<1)}function C(e,t){const a=e._frontFaceTranslucent,r=e._backFaceTranslucent;return a&&(t.cameraUnderground||r)}function S(e,t){return!t.cameraUnderground||e._frontFaceTranslucent}function A(e,t){return!t.cameraUnderground&&!e._frontFaceTranslucent}function v(e,t,a){return e._frontFaceTranslucent&&!e._backFaceTranslucent&&!a.depthTestAgainstTerrain&&t.mode!==m["a"].SCENE2D&&t.context.depthTexture}function x(e){let t=0;return e._frontFaceTranslucent&&++t,e._requiresManualDepthTest&&++t,t}function E(e,t){let a;e._derivedCommandsLength=O(e,t,!1,!1,e._derivedCommandTypes),e._derivedBlendCommandsLength=O(e,t,!0,!1,e._derivedBlendCommandTypes),e._derivedPickCommandsLength=O(e,t,!1,!0,e._derivedPickCommandTypes);let r=0;for(a=0;a<e._derivedCommandsLength;++a)r|=1<<e._derivedCommandTypes[a];for(a=0;a<e._derivedBlendCommandsLength;++a)r|=1<<e._derivedBlendCommandTypes[a];for(a=0;a<e._derivedPickCommandsLength;++a)r|=1<<e._derivedPickCommandTypes[a];let i=0;for(a=0;a<g;++a)(r&1<<a)>0&&(e._derivedCommandTypesToUpdate[i++]=a);e._derivedCommandsToUpdateLength=i;const o=r!==e._derivedCommandKey;e._derivedCommandKey=r,e._derivedCommandsDirty=o,!Object(n["a"])(e._derivedCommandPacks)&&e._frontFaceTranslucent&&(e._derivedCommandPacks=Z())}function O(e,t,a,r,i){let n=0;const o=e._frontFaceTranslucent,s=e._backFaceTranslucent;if(!o)return n;const c=t.cameraUnderground,u=e._requiresManualDepthTest,d=r?f.PICK_FRONT_FACE:u?f.TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:f.TRANSLUCENT_FRONT_FACE,l=r?f.PICK_BACK_FACE:u?f.TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:f.TRANSLUCENT_BACK_FACE;return t.mode===m["a"].SCENE2D?(i[n++]=f.DEPTH_ONLY_FRONT_FACE,i[n++]=d,n):(s?(a||(i[n++]=f.DEPTH_ONLY_FRONT_AND_BACK_FACE),c?(i[n++]=d,i[n++]=l):(i[n++]=l,i[n++]=d)):c?(a||(i[n++]=f.DEPTH_ONLY_BACK_FACE),i[n++]=f.OPAQUE_FRONT_FACE,i[n++]=l):(a||(i[n++]=f.DEPTH_ONLY_FRONT_FACE),i[n++]=f.OPAQUE_BACK_FACE,i[n++]=d),n)}function D(e,t){const a=e.indexOf(t);a>-1&&e.splice(a,1)}function F(e,t){return e.indexOf(t)>-1}function w(e,t){D(e.defines,"TRANSLUCENT"),D(t.defines,"TRANSLUCENT")}function R(e,t){D(e.defines,"GROUND_ATMOSPHERE"),D(t.defines,"GROUND_ATMOSPHERE"),D(e.defines,"FOG"),D(t.defines,"FOG"),D(e.defines,"TRANSLUCENT"),D(t.defines,"TRANSLUCENT")}function L(e,t){if(F(t.defines,"TILE_LIMIT_RECTANGLE")||F(t.defines,"ENABLE_CLIPPING_PLANES"))return;const a="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n";t.sources=[a]}function N(e,t){const a=t.sources,r=a.length;for(let n=0;n<r;++n)a[n]=l["a"].replaceMain(a[n],"czm_globe_translucency_main");const i="\n\nuniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n#ifdef MANUAL_DEPTH_TEST \n    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st)); \n    if (logDepthOrDepth != 0.0) \n    { \n        vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); \n        float depthEC = eyeCoordinate.z / eyeCoordinate.w; \n        if (v_positionEC.z < depthEC) \n        { \n            discard; \n        } \n    } \n#endif \n    czm_globe_translucency_main(); \n    vec4 classificationColor = texture2D(u_classificationTexture, st); \n    if (classificationColor.a > 0.0) \n    { \n        // Reverse premultiplication process to get the correct composited result of the classification primitives \n        classificationColor.rgb /= classificationColor.a; \n    } \n    gl_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + gl_FragColor * (1.0 - classificationColor.a); \n} \n";a.push(i)}function M(e,t){N(e,t),D(e.defines,"GROUND_ATMOSPHERE"),D(t.defines,"GROUND_ATMOSPHERE"),D(e.defines,"FOG"),D(t.defines,"FOG")}function P(e,t){N(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function I(e,t){M(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function B(e,t){const a="uniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n    vec4 pickColor = texture2D(u_classificationTexture, st); \n    if (pickColor == vec4(0.0)) \n    { \n        discard; \n    } \n    gl_FragColor = pickColor; \n} \n";t.sources=[a]}function j(e,t,a,r,i,o){if(!Object(n["a"])(i))return t;if(!r&&Object(n["a"])(a))return a;let s=e.shaderCache.getDerivedShaderProgram(t,o);if(!Object(n["a"])(s)){const a=t._attributeLocations,r=t.vertexShaderSource.clone(),c=t.fragmentShaderSource.clone();r.defines=Object(n["a"])(r.defines)?r.defines.slice(0):[],c.defines=Object(n["a"])(c.defines)?c.defines.slice(0):[],i(r,c),s=e.shaderCache.createDerivedShaderProgram(t,o,{vertexShaderSource:r,fragmentShaderSource:c,attributeLocations:a})}return s}function H(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0}function k(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0}function U(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function G(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function V(e){e.cull.enabled=!1,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function z(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0,e.depthMask=!1,e.blending=h["a"].ALPHA_BLEND}function W(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0,e.depthMask=!1,e.blending=h["a"].ALPHA_BLEND}function Y(e){e.cull.face=p["a"].BACK,e.cull.enabled=!0,e.blending.enabled=!1}function q(e){e.cull.face=p["a"].FRONT,e.cull.enabled=!0,e.blending.enabled=!1}function K(e,t,a,r,i){if(!Object(n["a"])(r))return e;if(!a&&Object(n["a"])(t))return t;let o=i[e.id];if(!Object(n["a"])(o)){const t=d["a"].getState(e);r(t),o=d["a"].fromCache(t),i[e.id]=o}return o}function $(e){return{u_classificationTexture:function(){return e._globeTranslucencyFramebuffer.classificationTexture}}}function Q(e,t,a,i,o){return Object(n["a"])(o)?!i&&Object(n["a"])(a)?a:Object(r["a"])(t,o(e),!1):t}function X(e){this.pass=e.pass,this.pickOnly=e.pickOnly,this.getShaderProgramFunction=e.getShaderProgramFunction,this.getRenderStateFunction=e.getRenderStateFunction,this.getUniformMapFunction=e.getUniformMapFunction,this.renderStateCache={}}function Z(){return[new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:w,getRenderStateFunction:H,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:R,getRenderStateFunction:k,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:L,getRenderStateFunction:U,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:L,getRenderStateFunction:G,getUniformMapFunction:void 0}),new X({pass:u["a"].GLOBE,pickOnly:!1,getShaderProgramFunction:L,getRenderStateFunction:V,getUniformMapFunction:void 0}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:N,getRenderStateFunction:z,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:M,getRenderStateFunction:W,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:P,getRenderStateFunction:z,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:I,getRenderStateFunction:W,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:B,getRenderStateFunction:Y,getUniformMapFunction:$}),new X({pass:u["a"].TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:B,getRenderStateFunction:q,getUniformMapFunction:$})]}Object.defineProperties(y.prototype,{frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance}},translucent:{get:function(){return this._frontFaceTranslucent}},sunVisibleThroughGlobe:{get:function(){return this._sunVisibleThroughGlobe}},environmentVisible:{get:function(){return this._environmentVisible}},useDepthPlane:{get:function(){return this._useDepthPlane}},numberOfTextureUniforms:{get:function(){return this._numberOfTextureUniforms}},rectangle:{get:function(){return this._rectangle}}}),y.prototype.update=function(e){const t=e.globe;if(!Object(n["a"])(t)||!t.show)return this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._sunVisibleThroughGlobe=!0,this._environmentVisible=!0,void(this._useDepthPlane=!1);this._frontFaceAlphaByDistance=b(t.translucency.enabled,t.translucency.frontFaceAlpha,t.translucency.frontFaceAlphaByDistance,this._frontFaceAlphaByDistance),this._backFaceAlphaByDistance=b(t.translucency.enabled,t.translucency.backFaceAlpha,t.translucency.backFaceAlphaByDistance,this._backFaceAlphaByDistance),this._frontFaceTranslucent=T(t.translucency.enabled,this._frontFaceAlphaByDistance,t),this._backFaceTranslucent=T(t.translucency.enabled,this._backFaceAlphaByDistance,t),this._requiresManualDepthTest=v(this,e,t),this._sunVisibleThroughGlobe=C(this,e),this._environmentVisible=S(this,e),this._useDepthPlane=A(this,e),this._numberOfTextureUniforms=x(this),this._rectangle=s["a"].clone(t.translucency.rectangle,this._rectangle),E(this,e)};const J=new Array(g),ee=new Array(g);function te(e,t,a,r,o,s,u){let d=t.derivedCommands.globeTranslucency;const l=e._derivedCommandsDirty;if(t.dirty||!Object(n["a"])(d)||l){t.dirty=!1,Object(n["a"])(d)||(d={},t.derivedCommands.globeTranslucency=d);const l=u.frameNumber,h=Object(i["a"])(d.uniformMapDirtyFrame,0),p=Object(i["a"])(d.shaderProgramDirtyFrame,0),m=Object(i["a"])(d.renderStateDirtyFrame,0),f=d.uniformMap!==t.uniformMap,g=d.shaderProgramId!==t.shaderProgram.id,_=d.renderStateId!==t.renderState.id;f&&(d.uniformMapDirtyFrame=l),g&&(d.shaderProgramDirtyFrame=l),_&&(d.renderStateDirtyFrame=l),d.uniformMap=t.uniformMap,d.shaderProgramId=t.shaderProgram.id,d.renderStateId=t.renderState.id;for(let y=0;y<a;++y){const a=s[y],b=r[y],T=o[y];let C,S,A,v=d[T];Object(n["a"])(v)?(C=v.uniformMap,S=v.shaderProgram,A=v.renderState):(C=void 0,S=void 0,A=void 0),v=c["a"].shallowClone(t,v),d[T]=v;const x=Object(i["a"])(v.derivedCommands.uniformMapDirtyFrame,0),E=Object(i["a"])(v.derivedCommands.shaderProgramDirtyFrame,0),O=Object(i["a"])(v.derivedCommands.renderStateDirtyFrame,0),D=f||x<h,F=g||E<p,w=_||O<m;D&&(v.derivedCommands.uniformMapDirtyFrame=l),F&&(v.derivedCommands.shaderProgramDirtyFrame=l),w&&(v.derivedCommands.renderStateDirtyFrame=l),v.derivedCommands.type=b,v.pass=a.pass,v.pickOnly=a.pickOnly,v.uniformMap=Q(e,t.uniformMap,C,D,a.getUniformMapFunction),v.shaderProgram=j(u.context,t.shaderProgram,S,F,a.getShaderProgramFunction,T),v.renderState=K(t.renderState,A,w,a.getRenderStateFunction,a.renderStateCache)}}}function ae(e,t,a,r,i,o,s){for(let c=0;c<t;++c){const t=e[c],u=t.derivedCommands.type;(!Object(n["a"])(s)||s.indexOf(u)>-1)&&a(t,r,i,o)}}function re(e,t,a,r,i,n){for(let o=0;o<t;++o)a(e[o],r,i,n)}y.prototype.updateDerivedCommands=function(e,t){const a=this._derivedCommandTypesToUpdate,r=this._derivedCommandsToUpdateLength;if(0!==r){for(let e=0;e<r;++e)ee[e]=this._derivedCommandPacks[a[e]],J[e]=_[a[e]];te(this,e,r,a,J,ee,t)}},y.prototype.pushDerivedCommands=function(e,t,a){const r=a.passes.pick;if(r&&t)return;let i=this._derivedCommandTypes,n=this._derivedCommandsLength;if(r?(i=this._derivedPickCommandTypes,n=this._derivedPickCommandsLength):t&&(i=this._derivedBlendCommandTypes,n=this._derivedBlendCommandsLength),0===n)return void a.commandList.push(e);const o=e.derivedCommands.globeTranslucency;for(let s=0;s<n;++s){const e=_[i[s]];a.commandList.push(o[e])}};const ie=[f.OPAQUE_FRONT_FACE,f.OPAQUE_BACK_FACE],ne=[f.DEPTH_ONLY_FRONT_FACE,f.DEPTH_ONLY_BACK_FACE,f.DEPTH_ONLY_FRONT_AND_BACK_FACE];y.prototype.executeGlobeCommands=function(e,t,a,r,i){const n=r.context,o=e.commands[u["a"].GLOBE],s=e.indices[u["a"].GLOBE];0!==s&&(this._globeTranslucencyFramebuffer=a,a.clearClassification(n,i),ae(o,s,t,r,n,i,ie))},y.prototype.executeGlobeClassificationCommands=function(e,t,a,r,i){const n=r.context,o=e.commands[u["a"].GLOBE],s=e.indices[u["a"].GLOBE],c=e.commands[u["a"].TERRAIN_CLASSIFICATION],d=e.indices[u["a"].TERRAIN_CLASSIFICATION];if(0===s||0===d)return;const l=this._frontFaceTranslucent,h=this._backFaceTranslucent;if(l&&h||re(c,d,t,r,n,i),!l&&!h)return;this._globeTranslucencyFramebuffer=a;const p=n.uniformState.globeDepthTexture,m=i.framebuffer;if(i.framebuffer=a.classificationFramebuffer,ae(o,s,t,r,n,i,ne),n.depthTexture){const e=a.packDepth(n,i);n.uniformState.globeDepthTexture=e}re(c,d,t,r,n,i),n.uniformState.globeDepthTexture=p,i.framebuffer=m},t["a"]=y},"6f08":function(e,t,a){"use strict";var r=a("77af"),i=a("bd8d"),n=a("2f63"),o=a("7d62"),s=a("f845"),c=a("f630"),u=a("6ef5"),d=a("6dc0"),l=a("3720"),h=a("987b"),p=a("b7c8"),m=a("3626"),f=a("6102"),g=a("25ef");function _(){this._picking=!1,this._numSamples=1,this._tempCopyDepthTexture=void 0,this._pickColorFramebuffer=new c["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._outputFramebuffer=new c["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._copyDepthFramebuffer=new c["a"],this._tempCopyDepthFramebuffer=new c["a"],this._updateDepthFramebuffer=new c["a"]({createColorAttachments:!1,createDepthAttachments:!1,depthStencil:!0}),this._clearGlobeColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._viewport=new r["a"],this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0}function y(e){e._pickColorFramebuffer.destroy(),e._outputFramebuffer.destroy(),e._copyDepthFramebuffer.destroy(),e._tempCopyDepthFramebuffer.destroy(),e._updateDepthFramebuffer.destroy()}function b(e,t,a,o,c){e._viewport.width=a,e._viewport.height=o;const u=!r["a"].equals(e._viewport,c.viewport);let _=u!==e._useScissorTest;e._useScissorTest=u,r["a"].equals(e._scissorRectangle,c.viewport)||(e._scissorRectangle=r["a"].clone(c.viewport,e._scissorRectangle),_=!0),Object(n["a"])(e._rs)&&r["a"].equals(e._viewport,e._rs.viewport)&&!_||(e._rs=d["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}}),e._rsBlend=d["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:p["a"].ALPHA_BLEND}),e._rsUpdate=d["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:f["a"].EQUAL,frontOperation:{fail:g["a"].KEEP,zFail:g["a"].KEEP,zPass:g["a"].KEEP},backFunction:f["a"].NEVER,reference:m["a"].CESIUM_3D_TILE_MASK,mask:m["a"].CESIUM_3D_TILE_MASK}})),Object(n["a"])(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(h["a"],{uniformMap:{u_depthTexture:function(){return e.colorFramebufferManager.getDepthStencilTexture()}},owner:e})),e._copyDepthCommand.framebuffer=e._copyDepthFramebuffer.framebuffer,e._copyDepthCommand.renderState=e._rs,Object(n["a"])(e._copyColorCommand)||(e._copyColorCommand=t.createViewportQuadCommand(l["a"],{uniformMap:{colorTexture:function(){return e.colorFramebufferManager.getColorTexture()}},owner:e})),e._copyColorCommand.renderState=e._rs,Object(n["a"])(e._tempCopyDepthCommand)||(e._tempCopyDepthCommand=t.createViewportQuadCommand(h["a"],{uniformMap:{u_depthTexture:function(){return e._tempCopyDepthTexture}},owner:e})),e._tempCopyDepthCommand.framebuffer=e._tempCopyDepthFramebuffer.framebuffer,e._tempCopyDepthCommand.renderState=e._rs,Object(n["a"])(e._updateDepthCommand)||(e._updateDepthCommand=t.createViewportQuadCommand(l["a"],{uniformMap:{colorTexture:function(){return e._tempCopyDepthFramebuffer.getColorTexture()}},owner:e})),e._updateDepthCommand.framebuffer=e._updateDepthFramebuffer.framebuffer,e._updateDepthCommand.renderState=e._rsUpdate,Object(n["a"])(e._clearGlobeColorCommand)||(e._clearGlobeColorCommand=new s["a"]({color:new i["a"](0,0,0,0),stencil:0,owner:e})),e._clearGlobeColorCommand.framebuffer=e.framebuffer}Object.defineProperties(_.prototype,{colorFramebufferManager:{get:function(){return this._picking?this._pickColorFramebuffer:this._outputFramebuffer}},framebuffer:{get:function(){return this.colorFramebufferManager.framebuffer}},depthStencilTexture:{get:function(){return this.colorFramebufferManager.getDepthStencilTexture()}},picking:{get:function(){return this._picking},set:function(e){this._picking=e}}}),_.prototype.update=function(e,t,a,r,i,n){const o=a.width,s=a.height,c=i?e.halfFloatingPointTexture?u["a"].HALF_FLOAT:u["a"].FLOAT:u["a"].UNSIGNED_BYTE;this._numSamples=r,this.picking?this._pickColorFramebuffer.update(e,o,s):this._outputFramebuffer.update(e,o,s,r,c),this._copyDepthFramebuffer.update(e,o,s),b(this,e,o,s,t),e.uniformState.globeDepthTexture=void 0,this._useHdr=i,this._clearGlobeDepth=n},_.prototype.prepareColorTextures=function(e,t){!this.picking&&this._numSamples>1&&this._outputFramebuffer.prepareTextures(e,t)},_.prototype.executeCopyDepth=function(e,t){Object(n["a"])(this._copyDepthCommand)&&(this.prepareColorTextures(e),this._copyDepthCommand.execute(e,t),e.uniformState.globeDepthTexture=this._copyDepthFramebuffer.getColorTexture())},_.prototype.executeUpdateDepth=function(e,t,a,r){const i=Object(n["a"])(r)?r:t.framebuffer.depthStencilTexture;if(a||i!==this.colorFramebufferManager.getDepthStencilTexture()){if(Object(n["a"])(this._updateDepthCommand)){if(!Object(n["a"])(this._updateDepthFramebuffer.framebuffer)||this._updateDepthFramebuffer.getDepthStencilTexture()!==i||this._updateDepthFramebuffer.getColorTexture()!==this._copyDepthFramebuffer.getColorTexture()){const a=this._copyDepthFramebuffer.getColorTexture().width,r=this._copyDepthFramebuffer.getColorTexture().height;this._tempCopyDepthFramebuffer.destroy(),this._tempCopyDepthFramebuffer.update(e,a,r);const n=this._copyDepthFramebuffer.getColorTexture();this._updateDepthFramebuffer.setColorTexture(n,0),this._updateDepthFramebuffer.setDepthStencilTexture(i),this._updateDepthFramebuffer.update(e,a,r),b(this,e,a,r,t)}this._tempCopyDepthTexture=i,this._tempCopyDepthCommand.execute(e,t),this._updateDepthCommand.execute(e,t)}}else Object(n["a"])(this._copyDepthCommand)&&this._copyDepthCommand.execute(e,t)},_.prototype.executeCopyColor=function(e,t){Object(n["a"])(this._copyColorCommand)&&this._copyColorCommand.execute(e,t)},_.prototype.clear=function(e,t,a){const r=this._clearGlobeColorCommand;Object(n["a"])(r)&&(i["a"].clone(a,r.color),this.colorFramebufferManager.clear(e,r,t))},_.prototype.isDestroyed=function(){return!1},_.prototype.destroy=function(){return y(this),Object(n["a"])(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),Object(n["a"])(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),Object(n["a"])(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),Object(n["a"])(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),Object(o["a"])(this)},t["a"]=_},8004:function(e,t,a){"use strict";var r=a("77af"),i=a("bd8d"),n=a("2f63"),o=a("7d62"),s=a("f845"),c=a("f630"),u=a("6ef5"),d=a("6dc0"),l=a("987b");function h(){this._framebuffer=new c["a"]({depthStencil:!0,supportsDepthTexture:!0}),this._packedDepthFramebuffer=new c["a"],this._renderState=void 0,this._packedDepthCommand=void 0,this._clearCommand=void 0,this._viewport=new r["a"],this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0}function p(e){e._framebuffer.destroy(),e._packedDepthFramebuffer.destroy()}function m(e,t,a,r,i){const n=i?t.halfFloatingPointTexture?u["a"].HALF_FLOAT:u["a"].FLOAT:u["a"].UNSIGNED_BYTE;e._framebuffer.update(t,a,r,1,n),e._packedDepthFramebuffer.update(t,a,r)}function f(e,t,a,o,c){e._viewport.width=a,e._viewport.height=o;const u=!r["a"].equals(e._viewport,c.viewport);let h=u!==e._useScissorTest;e._useScissorTest=u,r["a"].equals(e._scissorRectangle,c.viewport)||(e._scissorRectangle=r["a"].clone(c.viewport,e._scissorRectangle),h=!0),Object(n["a"])(e._renderState)&&r["a"].equals(e._viewport,e._renderState.viewport)&&!h||(e._renderState=d["a"].fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),Object(n["a"])(e._packedDepthCommand)||(e._packedDepthCommand=t.createViewportQuadCommand(l["a"],{uniformMap:{u_depthTexture:function(){return e.depthStencilTexture}},owner:e})),Object(n["a"])(e._clearCommand)||(e._clearCommand=new s["a"]({color:new i["a"](0,0,0,0),depth:1,stencil:0,owner:e})),e._packedDepthCommand.framebuffer=e._packedDepthFramebuffer.framebuffer,e._packedDepthCommand.renderState=e._renderState,e._clearCommand.framebuffer=e.classificationFramebuffer,e._clearCommand.renderState=e._renderState}Object.defineProperties(h.prototype,{classificationTexture:{get:function(){return this._framebuffer.getColorTexture()}},classificationFramebuffer:{get:function(){return this._framebuffer.framebuffer}},packedDepthFramebuffer:{get:function(){return this._packedDepthFramebuffer.framebuffer}},depthStencilTexture:{get:function(){return this._framebuffer.getDepthStencilTexture()}},depthStencilRenderbuffer:{get:function(){return this._framebuffer.getDepthStencilRenderbuffer()}},packedDepthTexture:{get:function(){return this._packedDepthFramebuffer.getColorTexture()}}}),h.prototype.updateAndClear=function(e,t,a,r){const i=t.width,n=t.height;m(this,a,i,n,e),f(this,a,i,n,r),this._useHdr=e},h.prototype.clearClassification=function(e,t){this._clearCommand.execute(e,t)},h.prototype.packDepth=function(e,t){return this._packedDepthCommand.execute(e,t),this.packedDepthTexture},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return p(this),Object(o["a"])(this)},t["a"]=h}}]);